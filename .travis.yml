language: generic

matrix:
  include:
    - os: linux
      sudo: false
      env: NODE_NVM_VERSION="4"
      addons:
        apt:
          sources:
           - ubuntu-toolchain-r-test
          packages:
           - libstdc++6
    - os: linux
      sudo: false
      env: NODE_NVM_VERSION="4" NPM_FLAGS="--debug"
      addons:
        apt:
          sources:
           - ubuntu-toolchain-r-test
          packages:
           - libstdc++6

env:
  global:
   # MapboxAccessToken for tilelive-vector
   - secure: "jNEQjRfPmyo7vmcP06tpWR+eTXpHhhdJuwRsR0Am5IYz7mttisrRKLi1hd08wZSSP1SOpBH+BX30hP2e0J8VLmn7hNhWHWxZFe5/vM8Gmg6OSfvpKhxdekfptdxfsC5aX6yVDJmethlX980l9BagsyYvYcepii9aBx5Xr8WZC9M="

before_install:
 - git clone https://github.com/creationix/nvm.git ../.nvm
 - source ../.nvm/nvm.sh
 - nvm install $NODE_NVM_VERSION
 - nvm use $NODE_NVM_VERSION
 - node --version
 - npm --version
 - if [[ $(uname -s) == 'Darwin' ]]; then sudo mdutil -i off /; fi;

install:
 - npm install --fallback-to-build=false ${NPM_FLAGS}

script:
 - npm test

notifications:
  slack:
    secure: LIF6zeIxEJtZKPIAconswMC3D0nrCiH/5kIUVZWJxW1o32YrnMUNXEFhOf740sKQtcU8uDXurss6yKKU/24D1pXPpXt/+QG1WT5+vq3AejcE46FXdbOhcjAukuBxCohiOuwiyJmmGaFDsH4NQ9nA0ROWRjF3wSi/fclik6zFpLQ=

